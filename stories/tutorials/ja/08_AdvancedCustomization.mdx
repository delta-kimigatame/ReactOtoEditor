import { Meta } from '@storybook/addon-docs/blocks';

<Meta title="Tutorial/ja/08.自動生成の高度なカスタマイズ" />

# 自動生成の高度なカスタマイズ

oto.ini自動生成機能のパラメータ初期値を細かく制御できます。
[6-3.新規作成する](/docs/tutorial-ja-06-3-新規作成する--docs)や[7-2.複数エイリアスを設定する](/docs/tutorial-ja-07-2-複数エイリアスを設定する--docs)の自動生成をより精密にカスタマイズしたい上級者向けの機能です。

## こんな時に使います

- ✅ **日本語以外の音源を作りたい** - 英語、中国語など、プリセットにない言語の音源
- ✅ **一般的ではないエイリアスを使用したい** - 独自の命名規則や特殊な音源形式

## 高度な設定項目の詳細

[7-2.複数エイリアスを設定する](/docs/tutorial-ja-07-2-複数エイリアスを設定する--docs)で触れた高度な設定について、詳しく解説します。

### チェックボックス項目

#### ファイル名途中のアンダーバーを1拍分の休符とみなす

まず、UTAUにおけるアンダーバー（`_`）の役割を理解しましょう。

**ファイル名の先頭のアンダーバー:**

UTAUでは、ファイル名を指定すると、そのファイルの1つ目の原音設定が呼び出されます。
しかし、「あ」と入力したときに「ああいあうえあ」などの連続音がすべてサジェストされるのは邪魔になります。

そこで、UTAU音源では以下の命名規則が使われます：
- **単独音**: `あ.wav`（アンダーバーなし）
- **連続音**: `_ああいあうえあ.wav`（アンダーバーで始める）

先頭に`_`を付けることで、直接呼び出されることを避けています。

**ファイル名の途中のアンダーバー:**

ファイル名の途中に`_`がある場合、2つの用途があります：

1. **区切り文字として使う場合**（チェックなし）
   - 例: `_a_a_i_a_u_e_a.wav`
   - ローマ字録音リストで単語の区切りを表す
   - アンダーバーは単なる区切り文字で、音楽的な意味はない

2. **休符として使う場合**（チェックあり）
   - 例: `_あ_か_さ_た.wav`
   - ガイドBGMの8拍の中に4つの音を録音（各音の間に1拍の休符）
   - `_`の位置で1拍分の無音があることを示す
   - 拍: `_あ__か__さ__た_`（_は1拍、音名は2拍）

**このチェックボックスの役割:**

- **チェックなし**: `_`は単なる区切り文字（連続した音として処理）
- **チェックあり**: `_`は1拍分の休符（音と音の間に無音があることを示す）

ガイドBGMを使った録音で、意図的に休符を入れている場合はチェックを入れます。

#### wavの頭のエイリアスに-をつける

語頭音（wavファイルの最初の音）のエイリアスに`-`（ハイフン）を付けるかどうかを設定します。

**連続音における語頭音の扱い:**

通常の連続音（VCV）では、`[- さ]`のようにハイフンを付けます。
これは、連続音では`[a さ]`、`[i さ]`、`[u さ]`など、前の母音からの繋がりが網羅されているためです。

しかし、本家UTAUの自動連続音モードは有料オプション機能のため、
連続音であっても単独音としても使える`[さ]`という形には合理性がある場合があります。

**2つの使い分け:**

1. **語頭と語中を区別する**（チェックあり）
   - 語頭: `[- さ]`
   - 語中: `[a さ]`、`[i さ]`など
   - 標準的な連続音の形式

2. **語頭と語中を区別しない**（チェックなし）
   - すべて: `[さ]`に統一
   - 連続発声で単独音を録音する場合
   - CVVCで語頭・語中を区別しない設計の場合

**このチェックボックスの役割:**

連続音の先頭音`[- さ]`と単独音`[さ]`を区別するか否かを決定します。

- **チェックあり**: `[- さ]`（連続音専用の語頭音として区別）
- **チェックなし**: `[さ]`（単独音としても使える形）

標準的な連続音を作る場合は**チェックあり**、単独音としても使いたい場合や特殊な音源形式では**チェックなし**を選びます。

#### wavの頭のエイリアスを生成する

wavファイルの先頭部分を音として自動生成するかどうかを設定します。

**単独音/CVVCにおける語頭と語中:**

単独音やCVVCでは、語頭音（歌い始めや休符の後）と語中音（母音から繋がる音）の扱いに3つの考え方があります：

1. **両方作成する**: `[- さ]`（語頭専用）と`[さ]`（語中専用）の両方を用意
2. **語中のみ作成する**: `[さ]`のみ（語頭は生成しない） ← **このチェックボックス**
3. **区別しない**: `[さ]`（語頭でも語中でも使える汎用音）

**このチェックボックスの役割:**

連続発声で収録した単独音やCVVCで、すべての単独音要素を語中音だけで構成したい場合に使用します。

**設定例:**

- **チェックあり**: `_あかさたな.wav`から`[- あ]`、`[か]`、`[さ]`、`[た]`、`[な]`を生成
  - wavファイルの先頭部分も音として使用
  
- **チェックなし**: `_あかさたな.wav`から`[か]`、`[さ]`、`[た]`、`[な]`のみ生成
  - 先頭の`[- あ]`は生成しない
  - wavファイルの先頭部分は前振りとして扱い、音としては使用しない

**使い分け:**

- **チェックあり**: 語頭音を含めてすべての音を活用する（通常の設定）
- **チェックなし**: 語頭部分は捨てて、語中音のみで音源を構成する（特殊な設計）

> 💡 **注意**: これは連続音（VCV）の話ではありません。連続音では語頭と語中を必ず区別します。
> この設定は、単独音やCVVCで語頭をどう扱うかを決めるものです。

#### 連続音を生成する

連続音（VCV: Vowel-Consonant-Vowel）を自動生成するかどうかを設定します。

**連続音とは:**

母音から次の子音+母音へ繋がる音のことです。例えば「かさ」と歌う場合：
- `[a か]`: 「あ」の母音から「か」へ
- `[a さ]`: 「あ」の母音から「さ」へ

> 💡 **注意**: 語頭音の`[- か]`などは連続音には含まれません。
> これらは原音設定上、語頭の単独音として扱われます。

**このチェックボックスの役割:**

- **チェックあり**: 連続音（VCV）を生成
- **チェックなし**: 連続音を生成しない

**プリセットとの関係:**

- **連続音用プリセット**: 読み込むと自動的にチェックが入る
- **CVVC用プリセット**: 読み込んだ後、このチェックをオンにすると連続音としてもCVVCとしても使える音源になる

**使用上の注意:**

1. **エイリアス数の上限**  
   本家UTAUには読み込めるエイリアス数に上限があります。
   連続音とCVVCの両方を生成すると、エイリアス数が大幅に増えます。
   常に両方の設定をすることが良いとは限りません。

2. **自動生成後の調整**  
   これはあくまで自動生成です。
   生成後、実際の音を聞きながら詳細な原音設定を行うのはあなた自身です。

#### 子音単体音を生成する

子音だけの音（例: `k`、`s`、`t`）を自動生成します。

**例:** `ka.wav`の場合
- チェックあり: 「か」と「k」の2つを生成
- チェックなし: 「か」のみ生成

CVVC音源など、子音単体音が必要な音源形式で使用します。

### 詳細設定（アコーディオン内）

#### 母音

母音のエイリアスと、それに対応するファイル名の種類を設定します。

<div style={{marginTop: '16px', marginBottom: '16px', border: '1px solid #ddd', borderRadius: '8px', overflow: 'hidden', height: '400px'}}>
  <iframe 
    src="iframe.html?id=components-targetdirdialog-makepanel-makepanelvowelaccordion--expanded&viewMode=story" 
    style={{width: '100%', height: '100%', border: 'none', pointerEvents: 'none'}}
    title="母音設定画面"
  />
</div>

**設定項目の意味:**

1. **母音のエイリアス**  
   連続音`[V CV]`や`[V C]`のV（母音）の部分に当てはまる文字を設定します。
   - 例: `a`、`i`、`u`、`e`、`o`

2. **種類（後方一致）, で区切る**  
   `[あ]`や`[a か]`における`[あ]`のように、次の母音を導くエイリアスを後方一致で指定します。
   - 複数ある場合は`,`（カンマ）で区切ります
   - **後方一致**なので、部分一致で広く対応できます

**設定例:**

```
母音: a
種類: あ,か,さ,た,な
```

「種類」に「か」を設定すると、`_あかさたな.wav`のファイル名において「か」の部分が母音「a」と判定されます。  
これにより、`[a さ]`のようなエイリアスが自動生成されます。

**後方一致の便利な使い方:**

- **「ゃ」と指定**: 「きゃ」「しゃ」「ちゃ」すべてに対応
- **「a」だけ指定**: ローマ字エイリアスの場合、`a`とだけ書けば`[a]`、`[ka]`、`[sa]`すべてに対応

**用途:**

この機能は通常の日本語連続音でもデフォルトで設定されています。特に以下のような場合に設定をカスタマイズします。

- 小書き文字（ぁ、ぃなど）にも対応したい
- 日本語以外の音源（アルファベット、中国語など）
- 拗音（きゃ、しゃなど）を一括設定したい

#### 子音

<div style={{marginTop: '16px', marginBottom: '16px', border: '1px solid #ddd', borderRadius: '8px', overflow: 'hidden', height: '400px'}}>
  <iframe 
    src="iframe.html?id=components-targetdirdialog-makepanel-makepanelconsonantaccordion--expanded&viewMode=story" 
    style={{width: '100%', height: '100%', border: 'none', pointerEvents: 'none'}}
    title="子音設定画面"
  />
</div>

子音のエイリアスと、それに対応するファイル名の種類、子音の平均長さを設定します。

:::info
この設定は基本的に**CVVC**のための設定です。  
VCV（連続音）の生成には子音設定は使用されず、すべて例外用設定（CVVC用設定）に登録されます。
:::

**設定項目:**

1. **子音**  
   CVVC形式の`[VC CV]`や`[VC C]`のC（子音）の部分に当てはまる文字を設定します。
   - 例: `k`、`s`、`t`、`n`、`h`

2. **種類（完全一致）, で区切る**  
   前置するVCを導く単独音を列挙します。
   - 複数ある場合は`,`（カンマ）で区切ります
   - **完全一致**なので、該当する単独音のみが対象になります
   - 通常、拗音とiの段は口蓋化により異なる子音（`ky`など）を割り当てます

3. **長さ（ms）**  
   子音部分の平均的な長さをミリ秒で指定します。
   - 破裂音（k、t、p）: 40-60ms程度
   - 摩擦音（s、sh、h）: 80-100ms程度

**設定例:**

```
子音: k
種類: か,く,け,こ
長さ: 60ms
```

「種類」に「か」を設定すると、`_あかさたな.wav`のファイル名において「か」の部分が子音「k」と判定されます。  
これにより、CVVC形式に必要な`[a k]`（VC: 母音+子音）と`[か]`（CV: 単独音）の両方が自動生成されます。

「き」は口蓋化するため除外し、別途`ky`として設定します（例: `子音: ky, 種類: き`）。

> 💡 **CVVCとは**: CV（単独音）とVC（母音+子音）の2種類の音を組み合わせて使用する音源形式です。  
> 例: `か`と歌う場合 → `[a k]`（VCで母音から子音へ）+ `[か]`（CVで子音から母音へ）

**例外設定: 子音欄が空欄の場合**

子音のエイリアスを空欄にして、種類だけを記入した場合、その音はCVVCではなく**連続音（VCV）として生成**されます。

```
子音: （空欄）
種類: あ,い,う,え,お
長さ: 0ms
```

これにより、`[a あ]`のような連続音エイリアスが生成されます（`[a a]`のようなVCは生成されません）。

**なぜこの設定が必要か:**

一般的な日本語CVVCでは、一部の音（あ行や撥音など）を連続音として実装する**混在形式**が一般的です。  
この例外設定により、連続音とCVVCの混在形式を柔軟にカスタマイズできます。

**デフォルト設定について:**

日本語連続音のプリセットを読み込んだ場合、想定されるすべての音がこの例外設定として登録されます。  
例外設定では長さの値は使用されないため、`0ms`となっています。

**用途:**

この機能は通常の日本語CVVCでもデフォルトで設定されています（特殊な子音や口蓋化子音も含む）。特に以下のような場合に設定をカスタマイズします。

- 子音の長さを言語や発音の特性に合わせて調整したい
- 日本語以外の音源でCVVC形式を使用する
- CVVCと連続音の混在形式をカスタマイズしたい

#### ファイル名の置換

<div style={{marginTop: '16px', marginBottom: '16px', border: '1px solid #ddd', borderRadius: '8px', overflow: 'hidden', height: '400px'}}>
  <iframe 
    src="iframe.html?id=components-targetdirdialog-makepanel-makepanelreplaceaccordion--expanded&viewMode=story" 
    style={{width: '100%', height: '100%', border: 'none', pointerEvents: 'none'}}
    title="ファイル名の置換設定画面"
  />
</div>

ファイル名からエイリアスへの変換ルールを設定します。

UTAUの世界では日本語が第一言語ですが、英語圏や多言語音源ではファイル名に日本語を使わず、
`_a_a_i_a_u_e_a.wav`のようなローマ字ファイル名が一般的です。

この機能は、ローマ字ファイル名を平仮名（日本語）に変換し、
例えば `[a]` → `[あ]` や `[ka]` → `[か]` のようなエイリアスを自動生成するためのものです。
また、アンダーバー（`_`）など不要な記号を除去することもできます。

**設定例:**
```
置換前: ka
置換後: か
置換前: a
置換後: あ
置換前: _
置換後: （空白）
```

この設定により、`_a_ka.wav` というファイル名は `a か` というエイリアスに変換されます。

> 💡 **注意:** 置換ルールは上から順に適用され、順番によって結果が変わります。
> 例えば `[a]→[あ]` と `[ka]→[か]` を両方登録した場合、
> `[ka]` を先に登録しないと `[ka]` が `[あ]` になってしまうことがあります。
> 必ず長い文字列（複雑なパターン）を上に、短いものを下に登録してください。

---

- 前のページ: [7-2.複数エイリアスを設定する](/docs/tutorial-ja-07-2-複数エイリアスを設定する--docs)
- チュートリアルトップ: [1.はじめに](/docs/tutorial-ja-01-はじめに--docs)
